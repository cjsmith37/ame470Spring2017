<html>
<head>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"
      integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
    crossorigin="anonymous"> </script>
<script src='asyncReq.js'> </script>
<script>
function addNew(){
  var file = $('#theFileUploader').get(0);
     var fileObj = $('#theFileUploader').get(0).files[0]
     var filename = fileObj.name;
     var ext = filename.split(".");
     ext = ext[ext.length-1];
     console.log(ext);

    var imageURL = new FormData();
    var id = new Date().getTime();
    if(imageURL.indexOf("http") >=0 && imageURL.length > 10){
      var url = "./addTodo" + "?id=" + id + "&url=" + imageURL + "&name=Untitled";
      loadFile(url ,function(d){
        formatTodos(JSON.parse(d));
      });
    }
  }


function cancelImageEdit()
{
  document.getElementById("DRFrame").src = "";
  document.getElementById("editWrapper").style.display = "none";
}
function editImage(){
   var url = document.getElementById("theImage").style.backgroundImage.replace('url("', "").replace('")','').replace("url('", "").replace("')",'');
   console.log(url);
   console.log(url);
   document.getElementById("DRFrame").src = "./demo/index.html#" + url;
   document.getElementById("editWrapper").style.display = "block";
 }

function deleteImage()
   {
      deleteTodo(currSel);
   }

   function deleteTodo(index){
         var flag = confirm("Are you sure you want to delete this?");
         if(flag){
           var url = "./deleteTodo" + "?id=" + index;
           loadFile(url ,function(d){
             formatTodos(JSON.parse(d));
           });
         }
       }

    function formatTodos(list){
        var markup = "";
        if(list.length == 0){
            markup = "No images yet"
            document.getElementById("todoListWrapper").innerHTML = markup;
            return;
          }
          for(var i = 0; i < list.length; i++){
            markup += "<li> <a href='javascript:imageSelected(" + list[i].id + "," + (i+1) + ")'>" + list[i].name +
                "</a></li>";
          }
          document.getElementById("todoListWrapper").innerHTML = markup;
          imageSelected(list[0].id);
        }

        var currSel = 0;
        function imageSelected(id, index){
            currSel = id;
            $("#todoListWrapper li a").removeClass("selected");
            $("#todoListWrapper li:nth-of-type(" + index + ") a").addClass("selected");
            var url = "./getTodo?id=" + id;
            loadFile(url ,function(d){
              var data = JSON.parse(d);
              document.getElementById("theTitle").innerHTML = data.name;
              document.getElementById("theImage").style.backgroundImage = "url(" + data.url + ")";
            });

        function start(){
          var url = "./getTodos";
          loadFile(url ,function(d){
            console.log(d);
            formatTodos(JSON.parse(d));
          })
        }

</script>
  <style>
      .selected{
        color: green;
        text-transform: uppercase;
      }
      h1{
        text-align: center;
      }
      .delButton
      {
          float: right;
      }
      #theImage{
        height: 200px;
        width: 100%;
        background-size: contain;
        background-position: 50%;
        background-repeat: no-repeat;
      }
      #editWrapper{
        display: none;
        background: rgba(0,0,0,.7);
        position: fixed;
        height: 100%;
        width: 100%;
        top: 0px;
        left: 0px;
      }
      #editWrapper button{
        position: fixed;
        float: right;
      }
      #DRFrame{
        position: fixed;
        height: 100%;
        width: 100%;
        top: 0px;
        left: 0px;
      }
  </style>
</head>

<body onload='start()'>
  <h1>Images</h1>
	<input type='file' id='fileUpload' onchange='addNew()'>
  <ol id='todoListWrapper'> </ol>
  <div id='theDetails'>
    <h1 id='theTitle'></h1>
    <div id='theImage'></div>
</div>
  <button onclick='editImage()'> Edit </button>
  <button onclick='deleteImage()'> Delete </button>
  <button onclick='renameImage()'> Rename </button>

  <div id='editWrapper'>
    <iframe crossorigin='anonymous'  id='DRFrame'> </iframe>
    <button style='right:0px' onclick='saveImageEdit()'> Save </button>
    <button onclick='cancelImageEdit()'> Cancel </button>
  </div>

</body>
</html>
